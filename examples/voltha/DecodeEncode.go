package main

import (
	"encoding/hex"
	"fmt"

	"github.com/cboling/omci"
	"github.com/google/gopacket"
)

func main() {
	decodeVolthaPacket()
}

func decodeVolthaPacket() {
	fmt.Println("======================================================")
	fmt.Println("======================================================")

	msgSequence_b1 := [...]string{
		"00014f0a00020000000000000000000000000000000000000000000000000000000000000000000000000028",
		"00024d0a00020000000000000000000000000000000000000000000000000000000000000000000000000028",
		"00034e0a00020000000000000000000000000000000000000000000000000000000000000000000000000028",
		"0114480a01000000020000000000000000000000000000000000000000000000000000000000000000000028",
		"0115440a01100001003000000000000000000000000000000000000000000000000000000000000000000028",
		"0116480a000b0101080001000000000000000000000000000000000000000000000000000000000000000028",
		"0117440a002d02020001008000140002000f0001000000000000000000000000000000000000000000000028",
		"0118440a00828002ffffffffffffffffffffffffffffffffffff000000000000000000000000000000000028",
		"0119440a002f21030202ff038002000000000000000000000000000000000000000000000000000000000028",
		"011a440a005421030ffb00000000000000000000000000000000000000000000100100000000000000000028",
		"011b440a002f0101020201010101000000000000000000000000000000000000000000000000000000000028",
		"011c480a000b0101080000000000000000000000000000000000000000000000000000000000000000000028",
		"011d580a0100000007e30801073a080000000000000000000000000000000000000000000000000000000028",
		"011e490a002d020220c000000000000000000000000000000000000000000000000000000000000000000028",
		"011f490a00828002007800000000000000000000000000000000000000000000000000000000000000000028",
		"0120490a002f21030fb800000000000000000000000000000000000000000000000000000000000000000028",
		"0121490a002f01010fb800000000000000000000000000000000000000000000000000000000000000000028",
		"0122440a014e00010000002f2103000000000000000000000000000000000000000000000000000000000028",
		"0123440a00180104000000000000000000000000000000000000000000000000000000000000000000000028",
		"0124440a00180101000000000000000000000000000000000000000000000000000000000000000000000028",
		"0125440a00180103000000000000000000000000000000000000000000000000000000000000000000000028",
		"0126440a00180102000000000000000000000000000000000000000000000000000000000000000000000028",
		"0127440a01388001000000000000000000000000000000000000000000000000000000000000000000000028",
		"0128440a014e00020000002f0101000000000002000000000000000000000000000000000000000000000028",
		"0129490a00180104400000000000000000000000000000000000000000000000000000000000000000000028",
		"012a490a00180101400000000000000000000000000000000000000000000000000000000000000000000028",
		"012b490a00180103400000000000000000000000000000000000000000000000000000000000000000000028",
		"012c490a00180102400000000000000000000000000000000000000000000000000000000000000000000028",
		"012d490a01388001400000000000000000000000000000000000000000000000000000000000000000000028",
		"012e490a01078001004400000000000000000000000000000000000000000000000000000000000000000028",
		"012f520a01078001000700000000000000000000000000000000000000000000000000000000000000000028",
		"0130480a01068000800004000000000000000000000000000000000000000000000000000000000000000028",
		"0131440a010c0408040080000380000000010100000000000000000000000000000000000000000000000028",
		"0132440a010a0408040805800200000001000000000000000000000000000000000000000000000000000028",
		"0133480a01158000010000000000000000000000000000000000000000000000000000000000000000000028",
		"0134480a008280027f8004080408040804080408040804080408000000000000000000000000000000000028",
		"0135440a00ab0202020101000000000000000000000000000000000000000000000000000000000000000028",
		"0136480a00ab0202380081008100000000000000000000000000000000000000000000000000000000000028",
		"0137480a00ab02020400f8000000f8000000000f000000007fdc000000000000000000000000000000000028",
		"0138490a010c040808c000000000000000000000000000000000000000000000000000000000000000000028",
		"013a490a00ab0202090000000000000000000000000000000000000000000000000000000000000000000028",
		"013b490a00ab0202040000000000000000000000000000000000000000000000000000000000000000000028",
		"013c5a0a00ab0202040000000000000000000000000000000000000000000000000000000000000000000028",
		"013d4b0a00020000000000000000000000000000000000000000000000000000000000000000000000000028",
		"013e4c0a00020000000000000000000000000000000000000000000000000000000000000000000000000028",
		"013f4c0a00020000000100000000000000000000000000000000000000000000000000000000000000000028",
		"01404c0a00020000000200000000000000000000000000000000000000000000000000000000000000000028",
		"0141490a01388001be0000000000000000000000000000000000000000000000000000000000000000000028",
		"01434c0a00020000000000000000000000000000000000000000000000000000000000000000000000000028",
		"01444c0a00020000000100000000000000000000000000000000000000000000000000000000000000000028",
		"01454c0a00020000000200000000000000000000000000000000000000000000000000000000000000000028",
		"0146490a0018010294aa00000000000000000000000000000000000000000000000000000000000000000028",
		"0147490a00180102ab1400000000000000000000000000000000000000000000000000000000000000000028",
		"0148490a00180102804100000000000000000000000000000000000000000000000000000000000000000028",
		"0149490a0018010494aa00000000000000000000000000000000000000000000000000000000000000000028",
		"014a490a00180104ab1400000000000000000000000000000000000000000000000000000000000000000028",
		"014b490a00180104804100000000000000000000000000000000000000000000000000000000000000000028",
	}

	msgSequence_b2 := [...]string{
		"014c460a00542103000000000000000000000000000000000000000000000000000000000000000000000028",
		"014d440a00542103001400000000000000000000000000000000000000000000100100000000000000000028",
		"014e460a00ab0202000000000000000000000000000000000000000000000000000000000000000000000028",
		"014f440a00ab0202020101000000000000000000000000000000000000000000000000000000000000000028",
		"0150480a00ab0202380081008100000000000000000000000000000000000000000000000000000000000028",
		"0151480a00ab02020400f8000000f8000000000f000000007fdc000000000000000000000000000000000028",
		"0152480a00ab02020400f8000000f8000000000f0000000000a4000000000000000000000000000000000028",
		"0153480a00ab02020400f800000080000000400f0000000800a4000000000000000000000000000000000028",
		"0154490a014e0001858e00000000000000000000000000000000000000000000000000000000000000000028",
		"0155490a014e0001b83100000000000000000000000000000000000000000000000000000000000000000028",
		"0156490a014e0001824000000000000000000000000000000000000000000000000000000000000000000028",
		"0157490a00ab0202090000000000000000000000000000000000000000000000000000000000000000000028",
		"0158490a00ab0202040000000000000000000000000000000000000000000000000000000000000000000028",
		"01595a0a00ab0202040000000000000000000000000000000000000000000000000000000000000000000028",
		"015a5a0a00ab0202040000010000000000000000000000000000000000000000000000000000000000000028",
		"015b490a01078001004400000000000000000000000000000000000000000000000000000000000000000028",
		"015c490a0018010394aa00000000000000000000000000000000000000000000000000000000000000000028",
		"015d490a00180103ab1400000000000000000000000000000000000000000000000000000000000000000028",
		"015e490a00180103804100000000000000000000000000000000000000000000000000000000000000000028",
	}

	fmt.Println("B1 ======================================================")

	for _, packetString_b1 := range msgSequence_b1 {
		data, err := stringToPacket(packetString_b1)

		if err != nil {
			fmt.Println(err)
		} else {
			packet := gopacket.NewPacket(data, omci.LayerTypeOMCI, gopacket.NoCopy)

			omciLayer := packet.Layer(omci.LayerTypeOMCI)

			omciMsg, ok := omciLayer.(*omci.OMCI)
			if ok {
				layerType, err := omci.MsgTypeToNextLayer(omciMsg.MessageType, false)

				if err != nil {
					fmt.Println(err)
				} else {
					fmt.Println(layerType)
				}
			}
		}
	}

	fmt.Println("B2 ======================================================")

	for _, packetString_b2 := range msgSequence_b2 {
		data, err := stringToPacket(packetString_b2)

		if err != nil {
			fmt.Println(err)
		} else {
			packet := gopacket.NewPacket(data, omci.LayerTypeOMCI, gopacket.NoCopy)

			omciLayer := packet.Layer(omci.LayerTypeOMCI)

			omciMsg, ok := omciLayer.(*omci.OMCI)
			if ok {
				layerType, err := omci.MsgTypeToNextLayer(omciMsg.MessageType, false)

				if err != nil {
					fmt.Println(err)
				} else {
					fmt.Println(layerType)
				}
			}
		}
	}
}

func stringToPacket(input string) ([]byte, error) {
	var p []byte

	p, err := hex.DecodeString(input)
	if err != nil {
		fmt.Println(err)
		return nil, err
	}
	return p, nil
}

func packetToString(input []byte) string {
	return hex.EncodeToString(input)
}
